{
    "category": "security",
    "question": "Conduct a comprehensive security audit to identify PostgreSQL users with insufficient or dangling permissions in a business database environment.\n\n## Your Mission:\n\nYou've been hired as a security consultant to audit the PostgreSQL database permissions for a growing e-commerce company. The company has experienced rapid growth and multiple teams have been granted database access over time. However, there's concern about permission inconsistencies and security gaps.\n\n## Security Audit Requirements:\n\n1. **Discover the database structure**: Identify all business tables and their purposes\n2. **Catalog all database users and roles**: Use `pg_user`, `pg_roles`, and `pg_auth_members` to find all accounts\n3. **Analyze current permissions**: Use `information_schema.table_privileges` to map permissions\n4. **Identify security issues**:\n   - **Dangling users**: Inactive accounts that should be removed\n   - **Missing permissions**: Users lacking permissions required for their business role\n   - **Excessive permissions**: Users with unnecessary permissions that should be revoked",
    "use_specified_server": true,
    "mcp_servers": [
        {
            "name": "postgres-pro"
        }
    ],
    "output_format": {
        "audit_status": "User permission audit completion status"
    },
    "prepares": [
        {
            "prepare_func": "mcpmark_postgres_setup",
            "prepare_args": {}
        }
    ],
    "evaluators": [
        {
            "func": "raw",
            "op": "postgres_security_verifier",
            "value": "completed",
            "op_args": {},
            "desc": "Check if the AI agent completed the comprehensive security audit"
        }
    ],
    "cleanups": [
        {
            "server": "mcpmark",
            "tool": "",
            "cleanup_func": "postgres_cleanup",
            "cleanup_args": {}
        }
    ]
}